<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <title>Toss Payments Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Toss Payment Widget -->
    <script src="https://js.tosspayments.com/v1/payment-widget"></script>
    <style>
        body { font-family: system-ui, sans-serif; padding: 24px; max-width: 720px; margin: auto; }
        .row { margin: 8px 0; }
        input { padding: 8px; width: 100%; }
        button { padding: 12px 16px; cursor: pointer; }
        #methods, #agreement { margin: 16px 0; }
    </style>
</head>
<body>
<h1>Toss Payments 테스트</h1>

<div class="row">
    <label>주문번호(orderId)</label>
    <input id="orderId" value="ORDER-TEST-001"/>
</div>

<div class="row">
    <label>주문명(orderName)</label>
    <input id="orderName" value="티켓 결제 테스트" />
</div>

<div class="row">
    <label>금액(amount, KRW)</label>
    <input id="amount" type="number" value="1000" />
</div>

<!-- 결제수단/약관 영역 렌더링 -->
<div id="methods"></div>
<div id="agreement"></div>

<button id="pay">결제하기</button>

<script>
    // 1) 환경 값
    const clientKey   = "test_gck_docs_Ovk5rk1EwkEbP0W43n07xlzm"; // ← 네 테스트 clientKey로 교체
    const customerKey = "customer-1234"; // 테스트용 임의의 유저 식별자(고정값 권장)

    // 2) 위젯 생성
    const paymentWidget = PaymentWidget(clientKey, customerKey);

    // 3) 입력된 금액으로 결제수단/약관 렌더
    function renderWidget() {
        const amount = Number(document.getElementById("amount").value || "0");
        paymentWidget.renderPaymentMethods("#methods", { value: amount, currency: "KRW" });
        paymentWidget.renderAgreement("#agreement");
    }
    renderWidget();
    document.getElementById("amount").addEventListener("input", renderWidget);

    // 4) 결제 요청
    document.getElementById("pay").addEventListener("click", async () => {
        const orderId   = document.getElementById("orderId").value.trim();
        const orderName = document.getElementById("orderName").value.trim();
        const amount    = Number(document.getElementById("amount").value || "0");

        if (!orderId || !orderName || amount <= 0) {
            alert("orderId / orderName / amount를 확인하세요.");
            return;
        }

        try {
            await paymentWidget.requestPayment({
                orderId,
                orderName,
                amount: { value: amount, currency: "KRW" },
                // 서버 컨트롤러의 리다이렉트 엔드포인트와 정확히 일치시켜야 함
                successUrl: "http://localhost:8080/api/payments/toss/success",
                failUrl:    "http://localhost:8080/api/payments/toss/fail"
            });
        } catch (e) {
            console.error(e);
            alert(e.message || "결제 요청 중 오류");
        }
    });
</script>
</body>
</html>